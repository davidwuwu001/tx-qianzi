# 通过模板发起合同

腾讯电子签 API 集成文档

---

## 一、流程概述

通过模板发起合同的整体流程分为两个阶段：
1. **控制台配置阶段**：添加印章、配置模板
2. **接口调用阶段**：创建签署流程 → 创建电子文档 → 发起签署流程

---

## 二、控制台配置

### 1. 登录电子签控制台

访问腾讯电子签控制台进行登录。

### 2. 创建印章

参考印章添加文档给企业添加印章。

### 3. 配置模板

#### 3.1 上传模板文件

上传需要签署的合同模板文件。

#### 3.2 设置签署区和填写区

页面右侧有三个区域用于配置：
- 签署区：用于放置签名/印章
- 填写区：用于填写合同内容

#### 3.3 设置控件对应的签署方

- **发起方填写控件**：如果期望在合同发起时通过接口填充，将控件设置给合同发起方
- **签署方填写控件**：如果期望在签署前由签署人手动填写，将控件设置给合同签署方

#### 3.4 保存模板并记录模板ID

保存模板后，记录生成的 `TemplateId`，后续接口调用需要使用。

> **注意**：通过 API 集成腾讯电子签时，部分功能需要通过接口指定，不依赖于模板中的配置。

---

## 三、接口调用

调用接口前需准备：
- `UserId`：操作人ID
- `TemplateId`：模板ID

### 1. 创建签署流程 (CreateFlow)

用于定义流程名称和构建签署方信息。

**签署方类型说明**：

| 类型 | ApproverType | 必要参数 |
|------|-------------|---------|
| 企业签署方 | 0 | OrganizationName(企业名称)、ApproverName(签署人姓名)、ApproverMobile(签署人手机号) |
| 个人签署方 | 1 | ApproverName(签署人姓名)、ApproverMobile(签署人手机号) |

**示例参数**：

```json
{
  "Approvers": [
    {
      "ApproverType": 0,
      "OrganizationName": "电子签测试企业",
      "ApproverName": "典子谦",
      "ApproverMobile": "188****"
    },
    {
      "ApproverType": 1,
      "ApproverName": "张三",
      "ApproverMobile": "186****"
    }
  ]
}
```

> **注意**：Approvers 数组中签署方的个数和顺序必须与模板中保持一致。

### 2. 创建电子文档 (CreateDocument)

将签署流程 (FlowId) 关联到模板 (TemplateId)。

如果模板中存在发起方的填写控件，需要通过 `FormFields` 参数进行填充：

```json
{
  "FlowId": "xxx",
  "TemplateId": "xxx",
  "FormFields": [
    {
      "ComponentId": "xxx",
      "ComponentValue": "填充值"
    }
  ]
}
```

**参数说明**：
- `ComponentId` 或 `ComponentName` 二选一
- 不同控件的 `ComponentValue` 格式可能有区别，详见 FormField 参数说明

### 3. 发起签署流程 (StartFlow)

发起流程，这是模板发起合同的最后一步。

```json
{
  "FlowId": "xxx"
}
```

---

## 四、更多场景

### 签署顺序

- **有序签署**（默认）：签署顺序同 CreateFlow 接口中 Approvers 数组顺序
- **无序签署**：将 CreateFlow 接口中的 `Unordered` 字段设置为 `true`

### 自动签署

若需要发起企业方自动签署的合同，请参见自动签署使用说明。

---

## 五、调用流程总结

```
┌─────────────────┐
│  CreateFlow     │  创建签署流程，定义签署方
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ CreateDocument  │  关联模板，填充表单字段
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   StartFlow     │  发起签署流程
└─────────────────┘
```

---

*文档来源：[腾讯电子签开发者文档](https://qian.tencent.com/developers/company/createFlowByTemplates)*

*Content was rephrased for compliance with licensing restrictions*
